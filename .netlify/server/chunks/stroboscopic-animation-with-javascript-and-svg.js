import { c as create_ssr_component, b as add_attribute } from "./index.js";
const misaligned = "/_app/immutable/assets/dash-array-misaligned-51406a73.png";
const aligned = "/_app/immutable/assets/dash-array-aligned-7c0c2e11.png";
const metadata = {
  "title": "Stroboscopic animation with JavaScript and SVG",
  "format": "article",
  "published": "2023-01-06",
  "updated": "2023-01-08",
  "short": "Creating an animation mimicking the effect of a stroboscopic light on a turntable using requestAnimationFrame, SVG and Vue.",
  "image": "src/lib/post_images/cover_images/stroboscopic-animation-with-javascript-and-svg.png",
  "image_alt": "Abstract stroboscopic dots lit in red ontop of a record"
};
const Stroboscopic_animation_with_javascript_and_svg = create_ssr_component(($$result, $$props, $$bindings, slots) => {
  return `<h2>Introduction</h2>
<p>One of my intentions in the development of <a href="${"https://crate.guide/"}" rel="${"nofollow"}">Crate Guide</a> was to build an interface that resembled closely that of a <a href="${"https://www.technics.com/global/home/sl1200/features.html"}" rel="${"nofollow"}">Technics SL-1200 turntable</a>, the most common turntable used by DJs. The idea was that the interface would be intuitive, requiring less learning and cognitive overhead. The web app is intended to be used on a laptop or desktop and only occasionally glanced at and interacted with during a performance.</p>
<p>Most of the interface proved fairly simple to represent in the browser, with the exception of one important feature, the subject of this post, the stroboscopic dots that circumscribe the platter. They provide an accurate visual reference for the pitch adjustment at a glace. The dots are lit by a red strobe light flashing at 50Hz (50 times per second). When the platter spins at +6.4%, +3.3%, 0% and -3.3% one of the four dots will be stationary.</p>
<p>I had several ideas on how to implement this, most of these involved having separate rows of dots rotating at a calculated rate according to the pitch adjustment. It wasn’t until I created the dots in the SVG and started playing with a simple spin animation that I realised it was possible to implement a stroboscopic effect with a 60Hz display. This method does have the downside of not working on non 60Hz displays, but is far more interesting, so I pursued it. In the future I’ll probably provide a fallback for other refresh rates.</p>
<p>A demo of this solution can be viewed in the app, without an account <a href="${"https://crate.guide/"}" rel="${"nofollow"}">here</a>.
The complete Single File Component can be viewed <a href="${"https://github.com/ryan-voitiskis/crate-guide/blob/main/client/src/components/session/deck/RecordPlatter.vue"}" rel="${"nofollow"}">here</a>.</p>
<h2>The SVG</h2>
<p>The SVG is placed within a wrapper in a Vue template. I won’t cover everything that’s going on here. It is a fairly simple SVG, but I will point out that the dots are created using the stroke-dasharray attribute. The dashes appear as dots by applying <code>stroke-linecap: round;</code> in the style and setting the first argument of stroke-dasharray to 0. The second argument is the distance between the dashes. This is what I adjusted to get the timing of the stroboscopic effect to function like that of the Technics turntable. More on this later.</p>
<pre class="${"language-markup"}"><!-- HTML_TAG_START -->${`<code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>template</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>record-platter-wrapper<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>svg</span>
      <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>366<span class="token punctuation">"</span></span>
      <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>366<span class="token punctuation">"</span></span>
      <span class="token attr-name">viewBox</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0 0 366 366<span class="token punctuation">"</span></span>
      <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>none<span class="token punctuation">"</span></span>
      <span class="token attr-name">xmlns</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>http://www.w3.org/2000/svg<span class="token punctuation">"</span></span>
      <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>record-platter<span class="token punctuation">"</span></span>
      <span class="token attr-name">ref</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>platter<span class="token punctuation">"</span></span>
    <span class="token punctuation">></span></span>
      <span class="token comment">&lt;!-- the platter ring --></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>g</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>circle</span> <span class="token attr-name">r</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>183<span class="token punctuation">"</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#000<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>circle</span> <span class="token attr-name">r</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>181<span class="token punctuation">"</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#d7d8dd<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>circle</span> <span class="token attr-name">r</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>180<span class="token punctuation">"</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#222<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>circle</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dots<span class="token punctuation">"</span></span> <span class="token attr-name">r</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>177.7<span class="token punctuation">"</span></span> <span class="token attr-name">stroke-dasharray</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0,3.303<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>circle</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dots large<span class="token punctuation">"</span></span> <span class="token attr-name">r</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>174<span class="token punctuation">"</span></span> <span class="token attr-name">stroke-dasharray</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0,3.33333<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>circle</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dots<span class="token punctuation">"</span></span> <span class="token attr-name">r</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>170<span class="token punctuation">"</span></span> <span class="token attr-name">stroke-dasharray</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0,3.3702<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>circle</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dots<span class="token punctuation">"</span></span> <span class="token attr-name">r</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>167<span class="token punctuation">"</span></span> <span class="token attr-name">stroke-dasharray</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>0,3.418<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>circle</span> <span class="token attr-name">r</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>165<span class="token punctuation">"</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#d7d8dd<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>g</span><span class="token punctuation">></span></span>

      <span class="token comment">&lt;!-- the record --></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>g</span> <span class="token attr-name">v-if</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>session.decks[deckID].loadedTrack?.recordID<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>clipPath</span> <span class="token attr-name">id</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>coverClip<span class="token punctuation">"</span></span><span class="token punctuation">></span></span>
          <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>circle</span> <span class="token attr-name">r</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>51<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>clipPath</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>circle</span> <span class="token attr-name">r</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>164<span class="token punctuation">"</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#000<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>circle</span> <span class="token attr-name">r</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>162.2<span class="token punctuation">"</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#151515<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>circle</span> <span class="token attr-name">r</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>142<span class="token punctuation">"</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#000<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>circle</span> <span class="token attr-name">r</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>141<span class="token punctuation">"</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#151515<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>circle</span> <span class="token attr-name">r</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>122<span class="token punctuation">"</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#000<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>circle</span> <span class="token attr-name">r</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>121<span class="token punctuation">"</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#151515<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>circle</span> <span class="token attr-name">r</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>100<span class="token punctuation">"</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#000<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>circle</span> <span class="token attr-name">r</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>99<span class="token punctuation">"</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#151515<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>circle</span> <span class="token attr-name">r</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>66<span class="token punctuation">"</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#030303<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>image</span>
          <span class="token attr-name">:href</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>coverImg<span class="token punctuation">"</span></span>
          <span class="token attr-name">height</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>104<span class="token punctuation">"</span></span>
          <span class="token attr-name">width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>104<span class="token punctuation">"</span></span>
          <span class="token attr-name">clip-path</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>url(#coverClip)<span class="token punctuation">"</span></span>
          <span class="token attr-name">x</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>-52<span class="token punctuation">"</span></span>
          <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>-52<span class="token punctuation">"</span></span>
        <span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>g</span><span class="token punctuation">></span></span>

      <span class="token comment">&lt;!-- the slipmat --></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>g</span> <span class="token attr-name">class</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>slipmat<span class="token punctuation">"</span></span> <span class="token attr-name">v-else</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>circle</span> <span class="token attr-name">r</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>164<span class="token punctuation">"</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#222<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>circle</span> <span class="token attr-name">r</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>146<span class="token punctuation">"</span></span> <span class="token attr-name">stroke-width</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>10<span class="token punctuation">"</span></span> <span class="token attr-name">stroke</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#8c4394<span class="token punctuation">"</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>transparent<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span>
          <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>-23<span class="token punctuation">"</span></span>
          <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#8c4394<span class="token punctuation">"</span></span>
          <span class="token attr-name">:transform</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>deckID === 1 ? 'rotate(180)' : ''<span class="token punctuation">"</span></span>
        <span class="token punctuation">></span></span>
          Crate
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>text</span>
          <span class="token attr-name">y</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>-23<span class="token punctuation">"</span></span>
          <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#b9adda<span class="token punctuation">"</span></span>
          <span class="token attr-name">:transform</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>deckID === 0 ? 'rotate(180)' : ''<span class="token punctuation">"</span></span>
        <span class="token punctuation">></span></span>
          Guide
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>text</span><span class="token punctuation">></span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>circle</span> <span class="token attr-name">r</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>2<span class="token punctuation">"</span></span> <span class="token attr-name">fill</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>#d7d8dd<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span>
      <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>g</span><span class="token punctuation">></span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>svg</span><span class="token punctuation">></span></span>
  <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>template</span><span class="token punctuation">></span></span></code>`}<!-- HTML_TAG_END --></pre>
<p>It is accompanied by the following style in a Single File Component:</p>
<pre class="${"language-markup"}"><!-- HTML_TAG_START -->${`<code class="language-markup"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>style</span> <span class="token attr-name">scoped</span> <span class="token attr-name">lang</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>scss<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token style"><span class="token language-css">
<span class="token selector">.record-platter-wrapper</span> <span class="token punctuation">&#123;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 660px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 2%<span class="token punctuation">;</span>
  <span class="token property">z-index</span><span class="token punctuation">:</span> 1<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">.record-platter</span> <span class="token punctuation">&#123;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 100%<span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">z-index</span><span class="token punctuation">:</span> 3<span class="token punctuation">;</span>
  <span class="token selector">g</span> <span class="token punctuation">&#123;</span>
    <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>183px<span class="token punctuation">,</span> 183px<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token selector">.dots</span> <span class="token punctuation">&#123;</span>
    <span class="token property">stroke</span><span class="token punctuation">:</span> #d7d8dd<span class="token punctuation">;</span>
    <span class="token property">stroke-width</span><span class="token punctuation">:</span> 1.6<span class="token punctuation">;</span>
    <span class="token property">stroke-linecap</span><span class="token punctuation">:</span> round<span class="token punctuation">;</span>
    <span class="token selector">&amp;.large</span> <span class="token punctuation">&#123;</span>
      <span class="token property">stroke-width</span><span class="token punctuation">:</span> 2.2<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
  <span class="token selector">.slipmat</span> <span class="token punctuation">&#123;</span>
    <span class="token selector">text</span> <span class="token punctuation">&#123;</span>
      <span class="token property">font-size</span><span class="token punctuation">:</span> 5rem<span class="token punctuation">;</span>
      <span class="token property">font-weight</span><span class="token punctuation">:</span> 600<span class="token punctuation">;</span>
      <span class="token property">letter-spacing</span><span class="token punctuation">:</span> 0.1rem<span class="token punctuation">;</span>
      <span class="token property">text-anchor</span><span class="token punctuation">:</span> middle<span class="token punctuation">;</span>
      <span class="token property">font-family</span><span class="token punctuation">:</span> <span class="token string">"Sonsie One"</span><span class="token punctuation">,</span> serif<span class="token punctuation">;</span>
      <span class="token property">user-select</span><span class="token punctuation">:</span> none<span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span>
</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>style</span><span class="token punctuation">></span></span></code>`}<!-- HTML_TAG_END --></pre>
<h2>JavaScript and requestAnimationFrame()</h2>
<p>Since this is a Vue component, I have utilised <a href="${"https://vuejs.org/guide/essentials/template-refs.html#template-refs"}" rel="${"nofollow"}"><code>ref</code></a>, <a href="${"https://vuejs.org/guide/essentials/computed.html#computed-properties"}" rel="${"nofollow"}"><code>computed</code></a> and <a href="${"https://vuejs.org/guide/essentials/watchers.html"}" rel="${"nofollow"}"><code>watch</code></a>. Here’s an explanation of what’s going on here:</p>
<ul><li>ref is referencing the SVG element.</li>
<li><code>fullRotationDuration</code> is a computed property that calculates the duration of a full rotation of the animation, based on the faderPosition, the turntablePitchRange in the settings and the rpm setting.</li>
<li><code>updateAnimation()</code> is a fairly typical implementation of <code>requestAnimationFrame()</code>, in that a calculation is made, a transform is applied to an element and the function is recursively called with <code>requestAnimationFrame()</code>. This is telling the browser to run the function again before the next repaint.</li>
<li>In this implementation, <code>angle</code> is set so that the <strong>time since last update ÷ full rotation duration × 360</strong> is added to the current angle of the element.</li>
<li>Starting the animation, which is controlled by the <em>start • stop</em> button is achieved by using a watch function. The watch function watches for a change in state and begins the animation if <em>playing</em> is true.</li>
<li>Ending the animation is achieved by checking the <em>playing</em> state at the start of <code>updateAnimation()</code> function, and returning out of the function if false, preventing the recursive call from being reached.</li></ul>
<pre class="${"language-ts"}"><!-- HTML_TAG_START -->${`<code class="language-ts"><span class="token keyword">const</span> platter <span class="token operator">=</span> <span class="token generic-function"><span class="token function">ref</span><span class="token generic class-name"><span class="token operator">&lt;</span>SVGElement<span class="token operator">></span></span></span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// duration of a full rotation in ms</span>
<span class="token keyword">const</span> fullRotationDuration <span class="token operator">=</span> <span class="token function">computed</span><span class="token punctuation">(</span>
	<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span>
		<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span>session<span class="token punctuation">.</span>decks<span class="token punctuation">[</span>props<span class="token punctuation">.</span>deckID<span class="token punctuation">]</span><span class="token punctuation">.</span>faderPosition <span class="token operator">*</span>
			<span class="token operator">-</span><span class="token number">0.0001</span> <span class="token operator">*</span>
			user<span class="token punctuation">.</span>authd<span class="token punctuation">.</span>settings<span class="token punctuation">.</span>turntablePitchRange <span class="token operator">+</span>
			<span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">*</span>
			<span class="token number">60</span><span class="token punctuation">)</span> <span class="token operator">/</span>
			session<span class="token punctuation">.</span>decks<span class="token punctuation">[</span>props<span class="token punctuation">.</span>deckID<span class="token punctuation">]</span><span class="token punctuation">.</span>rpm<span class="token punctuation">)</span> <span class="token operator">*</span>
		<span class="token number">1000</span>
<span class="token punctuation">)</span>

<span class="token keyword">let</span> lastTime <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// timestamp of the last frame</span>
<span class="token keyword">let</span> angle <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// current angle of rotation</span>

<span class="token keyword">function</span> <span class="token function">updateAnimation</span><span class="token punctuation">(</span>time<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">// if not playing or no platter exit function</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>session<span class="token punctuation">.</span>decks<span class="token punctuation">[</span>props<span class="token punctuation">.</span>deckID<span class="token punctuation">]</span><span class="token punctuation">.</span>playing <span class="token operator">||</span> <span class="token operator">!</span>platter<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token keyword">return</span>

	<span class="token keyword">const</span> elapsedTime <span class="token operator">=</span> time <span class="token operator">-</span> lastTime

	<span class="token comment">// update the angle of rotation</span>
	angle <span class="token operator">=</span> <span class="token punctuation">(</span>angle <span class="token operator">%</span> <span class="token number">360</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>elapsedTime <span class="token operator">/</span> fullRotationDuration<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">360</span>

	<span class="token comment">// update transform property of the platter SVG element</span>
	platter<span class="token punctuation">.</span>value<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">rotate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>angle<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">deg)</span><span class="token template-punctuation string">&#96;</span></span>

	lastTime <span class="token operator">=</span> time

	<span class="token comment">// request next frame</span>
	<span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>updateAnimation<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// watch playing state, if playing, start animation</span>
<span class="token function">watch</span><span class="token punctuation">(</span>
	<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> session<span class="token punctuation">.</span>decks<span class="token punctuation">[</span>props<span class="token punctuation">.</span>deckID<span class="token punctuation">]</span><span class="token punctuation">.</span>playing<span class="token punctuation">,</span>
	<span class="token punctuation">(</span>playing<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>playing<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			lastTime <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>updateAnimation<span class="token punctuation">)</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span></code>`}<!-- HTML_TAG_END --></pre>
<h2>How to achieve the stroboscopic effect</h2>
<p>As mentioned earlier, the stroboscopic effect is achieved by the appropriate distancing between the <code>stroke-dasharray</code> dashes. In this implentation I am targeting 60Hz displays. The turntable strobe flashes at 50Hz. It would have taken too long to count all the dots on the turntable platter, then count the dots in the dash array for a given spacing and then perform the calculations required to work this problem out mathematically. So I opted for the trial and error method, which didn’t take long.</p>
<p>I set the dash array circles to an approximate radius visually, then began approximating the distance between the dashes so that they were similar to that of the turntable. From there I could set the pitch fader control to +6.4%, +3.3%, 0% and -3.3% and adjust the dash array spacing for each so that the appropriate dash array appeared static.</p>
<p>This worked well, but the spacing that made the dots appear static at their given pitch adjustments left me with the problem of the dash array not joining up perfectly.</p>
<img class="${"center"}"${add_attribute("src", misaligned, 0)} alt="${"misaligned dash array"}">
<p>From this point I made small adjustments to join the dots perfectly. This was necessary because even very slightly misjoined dash arrays created artefacts in the animation.</p>
<img class="${"center"}"${add_attribute("src", aligned, 0)} alt="${"aligned dash array"}">
<h2>Limitations of this approach</h2>
<p>One limitation of using this method to animate the platter is that the accurate stroboscopic functionality is broken when the 45 RPM switch is activated. The 45 RPM setting is again just a visual indication as to the correct settings for a given track. It was intended to be set automatically when a track is loaded onto a deck. Unfortunately the data imported from the Discogs API, doesn’t have accurate RPM data, so unless a user is to manually add this data, the feature is functionally useless.</p>
<p>Possible solutions to overcome the stroboscopic functionality breaking on 45 RPM include:</p>
<ul><li>Changing the distance between the dashes when the setting is activated.</li>
<li>Running a separate animation for the platter group that is the speed of the animation at 33 RPM, whilst keeping the 45 RPM speed animation active on the record part of the SVG.</li></ul>
<p>Another limitation is the single refresh rate target of 60Hz. A possible solution for this could be to detect common refresh rates and apply adjustments to the animation of the platter ring for non 60Hz displays. I haven’t been able to find a built-in way to detect refresh rates in the browser, but <a href="${"https://stackoverflow.com/a/6131242/7259172"}" rel="${"nofollow"}">this answer on stack overflow</a> provides some direction.</p>
<h2>Performance issues</h2>
<p>This method does require a significant amount of compute resources to function seamlessly. With hardware acceleration turned off and both decks running, the animation uses about ~40% of my CPU (AMD 5600X) on chromium and ~30% on Firefox. With hardware acceleration on, the animation is smooth and CPU usage is minimal.</p>
<p>A functional requirement of Crate Guide is to run on crap laptops, which it does fine, however this animation may bog down such systems. The animation isn’t required for the app to function, and a note about avoiding this feature was left in the documentation.</p>
<h2>Possible future enhancements</h2>
<ul><li><p>I would like to limit the stroboscopic effect to just the area near the <em>start • stop</em> button, which will be lit up in red. The remaining sections of the platter rings would be blurred as they appear on a Technics turntable.</p></li>
<li><p>It’d also be nice to add some gradients and lighting effects to the platter and vinyl record.</p></li></ul>
<h2>Summary</h2>
<p>Using the refresh rate of monitors with performant <code>requestAnimationFrame()</code> animations to create stroboscopic effects is something I hadn’t considered before. I was able to mimic the stroboscopic effects of a turntable with some accuracy. Still, a lot could be done to improve the animation. I am interested to see whats possible with this technique outside of this use case.</p>
<p>The technique has some issues, the most pressing being the limited target refresh rate. I look forward to continuing work on this one day.</p>
<p>Thanks for getting this far. I’d be interested to hear your feedback at <a href="${"mailto:ryanvoitiskis@pm.me"}">ryanvoitiskis@pm.me</a></p>
<hr>
<h2>Continued: Adding speed up and slow down functions</h2>
<p>This enhancement isn’t relevant to the stroboscopic effect, but I thought I would include it here. To more accurately mimic the performance of a turntable, I added a speed up and slow down function. The code is pretty self explanatory.</p>
<pre class="${"language-ts"}"><!-- HTML_TAG_START -->${`<code class="language-ts"><span class="token keyword">let</span> lastTime <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// timestamp of the last frame</span>
<span class="token keyword">let</span> angle <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// current angle of rotation</span>
<span class="token keyword">let</span> speedUpRotationDuration <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// duration of a full rotation in ms when speeding up</span>
<span class="token keyword">let</span> slowDownRotationDuration <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// duration of a full rotation in ms when slowing down</span>

<span class="token keyword">function</span> <span class="token function">updateAnimation</span><span class="token punctuation">(</span>time<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token comment">// if not playing or no platter exit function</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>platter<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token keyword">return</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>session<span class="token punctuation">.</span>decks<span class="token punctuation">[</span>props<span class="token punctuation">.</span>deckID<span class="token punctuation">]</span><span class="token punctuation">.</span>playing<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		slowDownRotationDuration <span class="token operator">=</span> fullRotationDuration<span class="token punctuation">.</span>value
		<span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>slowDownAnimation<span class="token punctuation">)</span>
		<span class="token keyword">return</span>
	<span class="token punctuation">&#125;</span>

	<span class="token keyword">const</span> elapsedTime <span class="token operator">=</span> time <span class="token operator">-</span> lastTime

	<span class="token comment">// update the angle of rotation</span>
	angle <span class="token operator">=</span> <span class="token punctuation">(</span>angle <span class="token operator">%</span> <span class="token number">360</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>elapsedTime <span class="token operator">/</span> fullRotationDuration<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">360</span>

	<span class="token comment">// update transform property of the platter SVG element</span>
	platter<span class="token punctuation">.</span>value<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">rotate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>angle<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">deg)</span><span class="token template-punctuation string">&#96;</span></span>

	lastTime <span class="token operator">=</span> time

	<span class="token comment">// request next frame</span>
	<span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>updateAnimation<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">speedUpAnimation</span><span class="token punctuation">(</span>time<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>session<span class="token punctuation">.</span>decks<span class="token punctuation">[</span>props<span class="token punctuation">.</span>deckID<span class="token punctuation">]</span><span class="token punctuation">.</span>playing <span class="token operator">||</span> <span class="token operator">!</span>platter<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token keyword">return</span>
	<span class="token keyword">const</span> elapsedTime <span class="token operator">=</span> time <span class="token operator">-</span> lastTime
	angle <span class="token operator">=</span> <span class="token punctuation">(</span>angle <span class="token operator">%</span> <span class="token number">360</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>elapsedTime <span class="token operator">/</span> speedUpRotationDuration<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">360</span>
	speedUpRotationDuration <span class="token operator">-=</span> <span class="token number">200</span>
	platter<span class="token punctuation">.</span>value<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">rotate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>angle<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">deg)</span><span class="token template-punctuation string">&#96;</span></span>
	lastTime <span class="token operator">=</span> time
	<span class="token keyword">if</span> <span class="token punctuation">(</span>speedUpRotationDuration <span class="token operator">&lt;=</span> fullRotationDuration<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
		<span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>updateAnimation<span class="token punctuation">)</span>
	<span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>speedUpAnimation<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token keyword">function</span> <span class="token function">slowDownAnimation</span><span class="token punctuation">(</span>time<span class="token operator">:</span> <span class="token builtin">number</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
	<span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>platter<span class="token punctuation">.</span>value<span class="token punctuation">)</span> <span class="token keyword">return</span>
	<span class="token keyword">const</span> elapsedTime <span class="token operator">=</span> time <span class="token operator">-</span> lastTime
	angle <span class="token operator">=</span> <span class="token punctuation">(</span>angle <span class="token operator">%</span> <span class="token number">360</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token punctuation">(</span>elapsedTime <span class="token operator">/</span> slowDownRotationDuration<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token number">360</span>
	slowDownRotationDuration <span class="token operator">+=</span> <span class="token number">200</span>
	platter<span class="token punctuation">.</span>value<span class="token punctuation">.</span>style<span class="token punctuation">.</span>transform <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">rotate(</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>angle<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">deg)</span><span class="token template-punctuation string">&#96;</span></span>
	lastTime <span class="token operator">=</span> time
	<span class="token keyword">if</span> <span class="token punctuation">(</span>slowDownRotationDuration <span class="token operator">&lt;=</span> <span class="token number">8000</span><span class="token punctuation">)</span> <span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>slowDownAnimation<span class="token punctuation">)</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">// watch playing state, if playing, start animation</span>
<span class="token function">watch</span><span class="token punctuation">(</span>
	<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> session<span class="token punctuation">.</span>decks<span class="token punctuation">[</span>props<span class="token punctuation">.</span>deckID<span class="token punctuation">]</span><span class="token punctuation">.</span>playing<span class="token punctuation">,</span>
	<span class="token punctuation">(</span>playing<span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
		<span class="token keyword">if</span> <span class="token punctuation">(</span>playing<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
			speedUpRotationDuration <span class="token operator">=</span> fullRotationDuration<span class="token punctuation">.</span>value <span class="token operator">+</span> <span class="token number">6000</span>
			lastTime <span class="token operator">=</span> performance<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
			<span class="token function">requestAnimationFrame</span><span class="token punctuation">(</span>speedUpAnimation<span class="token punctuation">)</span>
		<span class="token punctuation">&#125;</span>
	<span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span></code>`}<!-- HTML_TAG_END --></pre>`;
});
export {
  Stroboscopic_animation_with_javascript_and_svg as default,
  metadata
};
